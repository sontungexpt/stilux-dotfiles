(self.webpackChunk=self.webpackChunk||[]).push([[5275],{33678:(e,t,n)=>{n.d(t,{A:()=>u,a:()=>i});var i,r=n(27378),s=n(88056),o=n(95195),a=n(95574);!function(e){!function(e){e.supportsSVGDominantBaseline="supportsSVGDominantBaseline",e.supportsSetGoalsLoader="supportsSetGoalsLoader",e.onlyTrustedEvents="onlyTrustedEvents"}(e.Flag||(e.Flag={})),e.Context=r.createContext(s.Y.invariantContent("PlatformEnvironment"));var t=function(){this.has=function(){return!1},this.actions={openUrl:function(){return o.F2(void 0)},openPopup:function(){return o.F2(void 0)}}};e.Mock=t}(i||(i={}));var u=function(){function e(){this.actions={openUrl:function(e){return a.vM((function(){throw new Error("Not implemented")}))},openPopup:function(e){return a.vM((function(){throw new Error("Not implemented")}))}}}return e.prototype.has=function(e){throw new Error("Not implemented")},e}()},88056:(e,t,n)=>{var i;n.d(t,{Y:()=>i}),function(e){e.invariantContent=function(e){return"function"==typeof Proxy?new Proxy({},{get:function(t,n){if(null==t[n])throw new Error("Please provide context using ".concat(e,".Context.Provider"));return t[n]}}):void 0}}(i||(i={}))},11596:(e,t,n)=>{n.r(t),n.d(t,{createSduiInlineEngine:()=>R,default:()=>H});var i=n(5114),r=n(31903),s=n(21038),o=n(24055),a=n(12054),u=n(78929),c=n(42040),d=n(46680),l=n(26393),p=n(92843),h=n(9922),f=n(93508),v=n(16118),m=n(77176),g=n(28811),w=n(54495);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,s=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var C=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._state=new Map,this._subs=new h.w.Keeper,this._log=c.C8.Logging.getLogger("SDUIInlineManager",d.i.TRACE,d.T.Manager.getColor()),this._subs.push(t.pipe(f.O(g.a.empty),v.G(),m.U((function(e){var t=I(e,2),n=t[0],i=t[1];return g.a.diff(n,i)})),m.U((function(e){return n._processSDUIItems(e)}))).subscribe())}var t,n,r;return t=e,(n=[{key:"getInlineItemForAlert",value:function(e){return i.fromNullable(this._state.get(e))}},{key:"_processSDUIItems",value:function(e){var t=this;(0,w.zG)(e,p.v.forEach((function(e){if(_(e)){var n=t;t._log.trace("inline item removed",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(e){return n._state.delete(e)}))}}),(function(e,n){if(_(n)){var i=t;t._log.trace("inline item updated",{alertIds:n.alertIds,itemId:n.id}),n.alertIds.forEach((function(e){return i._state.set(e,n)}))}}),(function(e){if(_(e)){var n=t;t._log.trace("inline item added",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(t){return n._state.set(t,e)}))}})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&b(t.prototype,n),r&&b(t,r),e}(),_=function(e){return(0,w.zG)(l.a.findFirst(e.content,"inlineCard"),i.isSome)},A=n(85985),S=n(80358),E=n(57050),F=n(84286),M=n(38983),k=n(72812),x=n(81136),P=n(22232),U=n(73975),G=n(40151),L=n(95195),T=n(8125);class N{constructor(){this.feed=G.E,this.currentFeed=i.none,this.onFeedRemove=G.E,this.onFeedEmpty=G.E,this.header=G.E,this.pushFeed=()=>L.F2(null),this.popFeed=T.Q1,this.focusCard=()=>L.F2(null),this.notifyCardFocused=T.Q1,this.dispose=T.Q1}}var O,V=n(12469),D=n(19716),Q=n(73582),j=n(32952),z=n(19751);class B{constructor(e,t,n){this.sduiManager=e,this.sduiFeedbackService=t,this._focusedItem=M.h.create(i.none),this._sduiInlineCardActions=new j.xQ,this._subs=new h.w.Keeper,this.focusCard=e=>{this._focusedItem.set(i.some(e))},this.handleSduiCardAction=(e,t,n)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:n})},this._handleSduiCardAction=({cardAction:e,match:t,cardModel:n})=>{this._sduiViewModel.sduiActionEvents.next(e),this._nativeHandling(e,t,n)},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new k.x(t,e,new N,n,this._focusedItem.view(i.map((e=>e.id)))),this._subs.push(this._sduiInlineCardActions.pipe(z.skipBy(O.eq)).subscribe(this._handleSduiCardAction),this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:n,scope:r},s,o){const a=e.filter((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type));(0,E.zG)(a,i.fromPredicate((e=>e.length>0)),i.map((e=>{o.onOpenExpandedViewBySduiAction(F.Oe.create(e,t,n,r))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"openLink":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"upgradeToPremium":return o.openPlanComparisonPage({forceUtmCampaign:Q.L.Place.assistantCardList}),void s.hide();case"applyAlerts":if(null==s.alert)return;return(0,E.zG)((0,V.UQ)(s.alert,s.plainText),(e=>new D.U_(e,(e=>s.replace(null!=e?e:"",!1)))),(t=>(0,E.zG)(i.fromNullable(t.replacements[e.alternativeIndex]),i.map((e=>t.getOnReplace(e)()))))),void s.hide();case"closeCard":case"removeRoot":return void s.hide();case"removeAlerts":return s.ignore(),void s.hide();default:(0,P.L0)(e)}}))}}!function(e){e.eq=U.MW({cardAction:x.t.eq})}(O||(O={}));const R=(e,t,n,c)=>{const d=new h.w.Keeper,l=(0,E.ls)((e=>e.toString()),n,i.fromNullable,i.map((e=>s.j.AlertId.from(e.id)))),p=e.capiEvents.pipe(A.h(S.hX.is("sdui_add","sdui_remove","sdui_update")),A.h((e=>"sdui_remove"===e.kind||F.D1.InlineCard.isInlineCard(e.sdui))),A.h(o.e.isSduiEvent),m.U(a.al.fromSource(a.i5.CAPI))),f=new u.G(p,l),v=new C(f.state),g=new r.Q({sendUserAction:c}),w=new B(f,g,(0,E.ls)(n,i.fromNullable));return d.push(t.subscribe((e=>f.notifyAlertsChanged())),e.capiEvents.pipe(A.h(S.hX.is("session_started")),A.h((e=>e.isNewSession))).subscribe((e=>f.onSessionStarted())),e.capiEvents.pipe(A.h(S.hX.is("finish")),A.h((e=>0===e.revision))).subscribe((e=>f.onFirstCheckingFinished())),f,v,w),{sduiBufferService:e,sduiManager:f,sduiInlineManager:v,sduiFeedbackService:g,inlineCardViewModel:w,dispose:()=>{d.dispose()}}},H={createSduiInlineEngine:R}}}]);